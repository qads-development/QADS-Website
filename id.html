<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Check</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #ffffff;
            color: #1a1a1a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: #2d3436;
        }

        p.subtitle {
            font-size: 1.1rem;
            color: #636e72;
            margin-bottom: 40px;
        }

        p.info-text {
            margin-top: 40px;
            font-size: 0.95rem;
            color: #b2bec3;
        }

        .verification-wrapper {
            padding: 10px 0;
            width: 100%;
            max-width: 420px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .verification-left {
            display: flex;
            align-items: center;
            gap: 18px;
        }

        #status-text {
            font-size: 1.1rem;
            font-weight: 500;
            color: #2d3436;
            transition: color 0.3s ease;
        }

        /* CHECKBOX AREA STYLES */
        #checkbox-area {
            display: none; 
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #dfe6e9;
            border-radius: 8px;
            width: 100%;
            max-width: 420px;
            background-color: #f8f9fa;
        }

        #checkbox-area label {
            display: flex;
            align-items: center;
            font-size: 1rem;
            color: #2d3436;
            cursor: pointer;
        }

        #verify-checkbox {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
        }

        #verify-button {
            margin-top: 15px;
            padding: 10px 20px;
            background-color: #6c5ce7;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s;
        }

        #verify-button:hover {
            background-color: #5d4cd6;
        }

        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #dfe6e9;
            border-top: 3px solid #6c5ce7;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-icon {
            display: none;
            width: 34px;
            height: 34px;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            animation: popIn 0.3s ease-out;
        }

        .status-icon.success { background-color: #6c5ce7; }
        .status-icon.failure { background-color: #d63031; }

        .icon-symbol {
            color: #fff;
            font-size: 18px;
            font-weight: bold;
        }

        @keyframes popIn {
            0% { transform: scale(0); }
            80% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .logo-area {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .custom-logo {
            max-width: 70px;
            height: auto;
            max-height: 40px;
            object-fit: contain;
        }

        .footer {
            position: fixed;
            bottom: 20px;
            width: 100%;
            text-align: center;
            font-size: 11px;
            color: #b2bec3;
            max-width: 600px;
        }
        
        .footer strong { color: #6c5ce7; }
        .mono-font { font-family: monospace; }

    </style>
</head>
<body>

    <h1>QADS.cloud</h1>
    <p class="subtitle">Checking your connection before accessing this site...</p>

    <div class="verification-wrapper">
        <div class="verification-left">
            <div class="spinner" id="spinner"></div>
            
            <div class="status-icon success" id="icon-success">
                <span class="icon-symbol">✓</span>
            </div>

            <div class="status-icon failure" id="icon-failure">
                <span class="icon-symbol">✕</span>
            </div>

            <span id="status-text">Initializing security...</span>
        </div>

        <div class="logo-area">
            <img src="logo.png" alt="Logo" class="custom-logo">
        </div>
    </div>
    
    <div id="checkbox-area">
        <label>
            <input type="checkbox" id="verify-checkbox">
            Verify your connection
        </label>
        <button id="verify-button" disabled>Verify Access</button>
    </div>

    <p class="info-text">Your connection is being verified to block robots and unsafe connections. This shouldn't be long.</p>

    <div class="footer">
        User : <span id="ray-id" class="mono-font">...</span> 
        &nbsp; | &nbsp; 
        Location: <span id="user-location" class="mono-font">...</span> 
        &nbsp; | &nbsp; 
        Security and verification by <strong>QADS.cloud</strong>
    </div>

    <script>
        let geoCountryCode = null;
        let geoTimezone = null;

        function generateRayID() {
            const hex = '0123456789abcdefghijklmnopqrstuvwxyz';
            let output = '';
            for (let i = 0; i < 16; i++) {
                output += hex.charAt(Math.floor(Math.random() * hex.length));
            }
            return output;
        }

        function getUserLocation() {
            const locationElement = document.getElementById('user-location');
            const fallbackLocation = "Montreal, CA (Server)";

            fetch('http://ip-api.com/json/?fields=city,countryCode,timezone')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success' && data.city && data.countryCode) {
                        geoCountryCode = data.countryCode;
                        geoTimezone = data.timezone;
                        locationElement.innerText = `${data.city}, ${data.countryCode} (Client)`;
                    } else {
                        locationElement.innerText = fallbackLocation;
                    }
                })
                .catch(error => {
                    console.error("Error fetching location:", error);
                    locationElement.innerText = fallbackLocation;
                });
        }

        const SecuritySystem = {
            score: 0,
            logs: [],

            checkWebDriver: function() {
                if (navigator.webdriver) {
                    this.logs.push("WebDriver detected.");
                    return 100;
                }
                return 0;
            },

            checkUserAgent: function() {
                const ua = navigator.userAgent.toLowerCase();
                const bots = ['headless', 'bot', 'crawl', 'spider', 'python', 'curl'];
                if (bots.some(bot => ua.includes(bot))) {
                    this.logs.push("Bot User-Agent detected.");
                    return 100;
                }
                return 0;
            },

            checkScreen: function() {
                if (window.outerWidth === 0 || window.outerHeight === 0 || window.innerWidth === 0) {
                    this.logs.push("Abnormal screen resolution (suspicious).");
                    return 50;
                }
                return 0;
            },

            checkPlugins: function() {
                if (!navigator.plugins || navigator.plugins.length === 0) {
                    return 10;
                }
                return 0;
            },

            checkTimeZoneVPN: function() {
                if (!geoTimezone) { return 0; }

                const browserTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                
                if (!browserTimezone.includes(geoTimezone.split('/')[0]) && geoCountryCode !== 'US') {
                     this.logs.push("Timezone mismatch (potential VPN/Proxy).");
                     return 50;
                }
                return 0;
            },

            runAll: function() {
                this.score += this.checkWebDriver();
                this.score += this.checkUserAgent();
                this.score += this.checkScreen();
                this.score += this.checkPlugins();
                this.score += this.checkTimeZoneVPN();
                
                if (this.score >= 100) { return 'HARD_FAIL'; } 
                else if (this.score >= 50) { return 'SOFT_FAIL'; } 
                else { return 'PASS'; }
            }
        };

        function handleVerificationPass() {
            localStorage.setItem('_verified-qadsid', 'True');
            
            const spinner = document.getElementById('spinner');
            if(spinner) spinner.style.display = 'none';
            
            document.getElementById('icon-success').style.display = 'flex';
            document.getElementById('status-text').innerText = "Connection verified";
            document.getElementById('status-text').style.color = "#2d3436";

            const urlParams = new URLSearchParams(window.location.search);
            const returnUrl = decodeURIComponent(urlParams.get('currentpage') || "");

            setTimeout(() => {
                if (returnUrl && returnUrl !== "null" && returnUrl !== "") {
                    window.location.href = returnUrl;
                } else {
                    window.location.href = "/"; 
                }
            }, 1500); 
        }

        function handleHardBlock() {
            document.getElementById('spinner').style.display = 'none';
            document.getElementById('icon-failure').style.display = 'flex';
            document.getElementById('status-text').innerText = "Your connection could not be verified. Access blocked.";
            document.getElementById('status-text').style.color = "#d63031";
        }

        function handleSoftBlock() {
            document.getElementById('spinner').style.display = 'none';
            const checkboxArea = document.getElementById('checkbox-area');
            const verifyButton = document.getElementById('verify-button');
            const statusText = document.getElementById('status-text');
            
            statusText.innerText = "Security check required.";
            statusText.style.color = "#2d3436";
            checkboxArea.style.display = 'block';

            document.getElementById('verify-checkbox').addEventListener('change', function() {
                verifyButton.disabled = !this.checked;
            });

            verifyButton.addEventListener('click', function() {
                if (document.getElementById('verify-checkbox').checked) {
                    checkboxArea.style.display = 'none';
                    handleVerificationPass();
                }
            });
        }

        document.addEventListener("DOMContentLoaded", function() {
            const spinner = document.getElementById('spinner');
            const textElement = document.getElementById('status-text');
            const rayIdElement = document.getElementById('ray-id');

            rayIdElement.innerText = generateRayID();
            getUserLocation();

            if (localStorage.getItem('_verified-qadsid') === 'True') {
                console.log("User already verified. Redirecting...");
                handleVerificationPass();
                return; 
            }

            const steps = ["Verifying connection...", "Verifying connection...", "Verifying connection..."];
            let stepIndex = 0;

            const statusInterval = setInterval(() => {
                if(stepIndex < steps.length) {
                    textElement.innerText = steps[stepIndex];
                    stepIndex++;
                }
            }, 800);

            setTimeout(() => {
                clearInterval(statusInterval);
                const result = SecuritySystem.runAll();

                if (result === 'PASS') {
                    handleVerificationPass();
                } else if (result === 'SOFT_FAIL') {
                    handleSoftBlock();
                } else {
                    handleHardBlock();
                }
            }, 5000);
        });
    </script>

</body>
</html>
